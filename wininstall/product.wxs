<?xml version="1.0" encoding="utf-8"?>
<?define ProductName = "Chez Scheme Version $(var.Version)"?>
<?define Manufacturer = "Cisco Systems, Inc."?>
<?if $(sys.BUILDARCH)="x86"?>
    <?define UpgradeCode="e183c83e-1216-446f-bee1-f25db3297efa"?>
    <?define ProductId="49f75024-1225-42e4-aa8d-15ddb60a13d2"?>
<?elseif $(sys.BUILDARCH)="x64"?>
    <?define UpgradeCode="e183c83e-1216-446f-bee1-f25db3297efa"?>
    <?define ProductId="49f75024-1225-42e4-aa8d-15ddb60a13d2"?>
<?else?>
    <?error Unsupported value of sys.BUILDARCH=$(sys.BUILDARCH)?>
<?endif?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product
      Name="$(var.ProductName)"
      Id="$(var.ProductId)"
      UpgradeCode="$(var.UpgradeCode)"
      Language="1033"
      Codepage="1252"
      Version="$(var.Version)"
      Manufacturer="$(var.Manufacturer)">
    <Package
        InstallerVersion="301"
        Keywords="Installer"
        Description="$(var.ProductName) Installer"
        Manufacturer="$(var.Manufacturer)"
        InstallScope="perMachine"
        Languages="1033"
        Compressed="yes"
        SummaryCodepage="1252"/>
    <MediaTemplate EmbedCab="yes"/>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder" Name="Program Files">
        <Directory Id="APPLICATIONFOLDER" Name="$(var.ProductName)">
          <Directory Id="D_bin" Name="bin"/>
          <Directory Id="D_boot" Name="boot"/>
          <?if $(sys.BUILDARCH)="x86"?><Directory Id="D_examples" Name="examples"/><?endif?>
        </Directory>
        <Directory Id="ProgramFiles64Folder" Name="Program Files">
          <Directory Id="APPLICATIONFOLDER64" Name="$(var.ProductName)">
            <Directory Id="D_bin64" Name="bin"/>
            <Directory Id="D_boot64" Name="boot"/>
            <?if $(sys.BUILDARCH)="x64"?><Directory Id="D_examples" Name="examples"/><?endif?>
          </Directory>
        </Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="D_shortcuts" Name="$(var.ProductName)"/>
      </Directory>
    </Directory>
    <Feature Id="Examples" Level="1" Title="Chez Scheme examples">
      <ComponentGroupRef Id="examples"/>
    </Feature>
    <?if $(sys.BUILDARCH)="x86"?>
      <Feature Id="i3nt" Level="1" Title="Chez Scheme 32-bit nonthreaded">
        <ComponentGroupRef Id="i3nt"/>
      </Feature>
      <Feature Id="ti3nt" Level="1" Title="Chez Scheme 32-bit threaded">
        <ComponentGroupRef Id="ti3nt"/>
      </Feature>
    <?endif?>
    <?if $(sys.BUILDARCH)="x64"?>
      <Feature Id="a6nt" Level="1" Title="Chez Scheme 64-bit nonthreaded">
        <ComponentGroupRef Id="a6nt"/>
      </Feature>
      <Feature Id="ta6nt" Level="1" Title="Chez Scheme 64-bit threaded">
        <ComponentGroupRef Id="ta6nt"/>
      </Feature>
    <?endif?>
    <Icon Id="cs.ico" SourceFile="../c/cs.ico"/>
    <?if $(sys.BUILDARCH)="x86"?>
      <DirectoryRef Id="TARGETDIR">
        <Merge Id="VCRedist32mm"
               SourceFile="C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Redist\MSVC\14.11.25325\MergeModules\Microsoft_VC141_CRT_x86.msm"
               DiskId="1"
               Language="0"/>
      </DirectoryRef>
      <Feature Id="VCRedist32"
           Title="Visual C++ 8.0 Runtime (32 bit)"
           AllowAdvertise="no"
           Display="hidden"
           Level="1">
        <MergeRef Id="VCRedist32mm"/>
      </Feature>
    <?endif?>
    <?if $(sys.BUILDARCH)="x64"?>
      <DirectoryRef Id="TARGETDIR">
        <Merge Id="VCRedist64mm"
               SourceFile="C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Redist\MSVC\14.11.25325\MergeModules\Microsoft_VC141_CRT_x64.msm"
               DiskId="1"
               Language="0"/>
      </DirectoryRef>
      <Feature Id="VCRedist64"
           Title="Visual C++ 8.0 Runtime (64 bit)"
           AllowAdvertise="no"
           Display="hidden"
           Level="1">
        <MergeRef Id="VCRedist64mm"/>
      </Feature>
    <?endif?>
    <Property Id="ARPPRODUCTICON" Value="cs.ico"/>
    <UIRef Id="WixUI_Advanced"/>
    <WixVariable Id="WixUILicenseRtf" Value="license.rtf"/>
    <Property Id="ApplicationFolderName" Value="$(var.ProductName)"/>
    <Property Id="WixAppFolder" Value="WixPerMachineFolder"/>
  </Product>
</Wix>
